/**
 * Core Philosophy: This ruleset enforces that only authenticated users can
 * access the database. For this initial version, any authenticated user can
 * create, read, update, and delete student and transaction records. This is a
 * permissive setup to facilitate rapid development and prototyping. In a
 * production environment, these rules would be refined to implement more
* granular, role-based access control (e.g., distinguishing between admins,
 * teachers, and parents).
 *
 * Data Structure:
 * - /students/{studentId}: Contains student ledger information.
 * - /transactions/{transactionId}: A log of all financial transactions.
 * - /summary/{summaryId}: A singleton document for global financial summaries.
 *
 * Key Security Decisions:
 * - Authenticated Access Only: All operations require the user to be signed in.
 *   There is no public or unauthenticated access to any data.
 * - Open Access for Authenticated Users: To simplify development, any signed-in
 *   user has full CRUD (Create, Read, Update, Delete) permissions on student
 *   and transaction records.
 * - No Data Shape Validation: The rules focus solely on authorization (who can
 *   access what) and do not validate the schema of the data being written.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    //-------------------------------------------------------------------------
    // Helper Functions
    //-------------------------------------------------------------------------

    /**
     * Checks if the user is authenticated.
     */
    function isSignedIn() {
      return request.auth != null;
    }

    //-------------------------------------------------------------------------
    // Collection Rules
    //-------------------------------------------------------------------------

    /**
     * @description Manages student records. Any authenticated user can perform any action.
     * @path /students/{studentId}
     */
    match /students/{studentId} {
      allow read, write: if isSignedIn();
    }
    
    /**
     * @description Manages all transactions. Any authenticated user can access these records.
     * @path /transactions/{transactionId}
     */
    match /transactions/{transactionId} {
        allow read, write: if isSignedIn();
    }

    /**
     * @description Manages a singleton summary document. Any authenticated user can read or write.
     * @path /summary/{summaryId}
     */
    match /summary/{summaryId} {
      allow read, write: if isSignedIn();
    }
  }
}
